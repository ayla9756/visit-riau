generator client {
   provider = "prisma-client-js"
}

datasource db {
   provider  = "postgresql"
   url       = env("DATABASE_URL")
   directUrl = env("DIRECT_URL")
}

model User {
   id           String        @id @default(cuid())
   name         String
   email        String        @unique
   password     String
   authSessions AuthSession[]
   role         Role          @default(ADMIN)
   createdAt    DateTime      @default(now())
}

model AuthSession {
   id         String    @id @default(cuid())
   userId     String
   token      String    @db.Text
   expiresAt  DateTime
   lastUsedAt DateTime? @default(now())
   revoked    Boolean   @default(false)
   revokedAt  DateTime?

   user      User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt

   @@index([userId])
}

model Kategori {
   id        String   @id @default(cuid())
   nama      String
   slug      String   @unique
   deskripsi String?
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt

   makanan Makanan[]
}

model Makanan {
   id           String   @id @default(cuid())
   nama         String
   slug         String   @unique
   deskripsi    String?
   asal         String?
   view         Int      @default(0)
   images       Image[]
   reviews      Review[]
   kategori     Kategori @relation(fields: [kategoriSlug], references: [slug])
   kategoriSlug String
   createdAt    DateTime @default(now())
   updatedAt    DateTime @updatedAt
}

model Image {
   id        String   @id @default(cuid())
   imageUrl  String
   fileId    String   @unique
   makanan   Makanan? @relation(fields: [makananId], references: [id])
   makananId String?
   createdAt DateTime @default(now())
}

model Review {
   id        String   @id @default(cuid())
   rating    Int?
   nama      String?
   komentar  String?
   email     String
   makanan   Makanan  @relation(fields: [makananId], references: [id])
   makananId String
   approve   Boolean  @default(false)
   createdAt DateTime @default(now())
}

enum Role {
   ADMIN
   USER
}
